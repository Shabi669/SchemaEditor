<head>
  <title>Schema Editor</title>

  <link rel="stylesheet" href="" </head>

  <body>
    <div ng-app="ngApplication" ng-controller="ngPageController" class="main container-fluid" ng-model="app.filter.text" ng-keyup="app.keydown($event)"
      tabindex="0">

      <!-- Nav Bar -->
      <nav class="navbar navbar-static-top">

      </nav>

      <!-- Top Bar -->
      <div class="panel top-bar form-group col-lg-12">
        <input id="tbxSearch" type="text" class="form-control" ng-model="app.filter.text" ng-change="app.filter.change()" />
        <span class="glyphicon glyphicon-search"></span>
      </div>

      <!-- Content Area -->
      <div class="main-content">

        <!-- Side Bar -->
        <div class="col-lg-3 side-bar">
          <div class="panel panel-info">

            <div class="panel-heading">
              <div class="dropdown">
                <span class="dropdown-toggle" type="button" data-toggle="dropdown">{{category.selected.title}}
                  <span class="caret"></span>
                </span>
                <ul class="dropdown-menu">
                  <li ng-repeat="item in category.list">
                    <a ng-click="category.set(item)">{{item.title}}</a>
                  </li>
                </ul>
              </div>
              <span class="glyphicon glyphicon-plus" ng-click="entity.edit()"></span>
            </div>

            <div class="panel-body">
              <div class="list-group">
                <div class="list-group-item {{item.metaType}}" ng-repeat="item in filteredEntities = (entities | filter:entity.filter | orderBy:['metaType', 'title']) "
                  ng-class="{active:item.title == entity.selected.title}" ng-click="entity.select(item)">

                  <span title="{{item._id}}">{{item.title}}</span>

                  <span class="icons">
                      <span class="dropdown" ng-if="item.metaType == 'entity'">
                        <span class="dropdown-toggle" type="button" data-toggle="dropdown">
                          <span class="glyphicon glyphicon-save-file" title="Export to file"></span>
                  </span>

                  <ul class="dropdown-menu dropdown-menu-right">
                    <li><a href="/file/{{item._id}}/normal">Schema</a></li>
                    <li role="separator" class="divider"></li>
                    <li><a href="/file/{{item._id}}/flat">Flat Schema</a></li>
                  </ul>
                  </span>

                  <span class="glyphicon glyphicon-edit" title="Edit" ng-click="entity.edit(item)"></span>
                  <span class="glyphicon glyphicon-remove" title="Edit" ng-click="entity.remove(item); $event.stopPropagation();"></span>
                  </span>
                </div>
              </div>
            </div>

          </div>
        </div>

        <!-- Entity Info -->
        <div class="col-lg-9 fade-in" ng-if="entity.selected">
          <div class="panel panel-info properties">
            <div class="panel-heading">
              <span>{{entity.selected.title}}</span>
              <span class="glyphicon glyphicon-edit" ng-click="property.edit(entity.selected)"></span>
            </div>
            <div class="panel-body">
            </div>
          </div>
        </div>

        <!-- Properties -->
        <div class="col-lg-9" ng-if="entity.selected">

          <div class="panel panel-info properties">
            <div class="panel-heading">
              <span>Properties</span>
              <span class="glyphicon glyphicon-plus" ng-class="{disabled:!entity.selected}" ng-click="property.edit(entity.selected)"></span>
            </div>
            <div class="panel-body">

              <property-table entity="entity.selected" filter="property.filter" api="property"></property-table>

            </div>
          </div>
        </div>

        <!-- Links -->
        <div class="col-lg-9 fade in out" ng-if="entity.selected">

          <div class="panel panel-info properties">
            <div class="panel-heading">
              <span>Links</span>
              <span class="glyphicon glyphicon-plus" ng-class="{disabled:!entity.selected}" ng-click="entity.edit(entity.selected)"></span>
            </div>
            <div class="panel-body">

              <links-table entity="entity.selected" filter="link.filter" api="entity"></links-table>

            </div>
          </div>
        </div>

        <entity-list entities="entities"></entity-list>

      </div>

      <!-- Footer -->
      <footer>
        <span>{{entity.selected | json}}</span>
        <!--<test ng-if="entity.selected" entity="entity.selected"></test>-->
      </footer>

      <!-- Edit Item Modal -->
      <!--<entity-list></entity-list>-->
      <!--<entity-edit></entity-edit>-->

      <div id="editEntityModal" class="modal fade" role="dialog" ng-keydown="entity.keyDown($event)">
        <div class="modal-dialog">
          <div class="modal-content">

            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal">&times;</button>
              <h4 class="modal-title">Edit Item</h4>
            </div>

            <div class="modal-body">
              <div class="form-group">
                <label ng-class="{invalid:!entity.validation.title()}">Title</label>
                <input type="text" class="form-control" ng-model="entity.selected.title" placeholder="Item title" />
              </div>

              <div class="form-group">
                <label for="">Type</label>
                <select class="form-control" ng-model="entity.selected.metaType">
                  <option value="entity">Entity</option>
                  <option value="link">Entity Link</option>
                  <option value="common">Common Type</option>
                </select>
              </div>

              <!-- Entity -->
              <div ng-if="entity.selected.metaType == 'entity'">

              <div class="form-group">
                <label for="">Type Of</label>
                <select class="form-control" ng-model="entity.selected.base" ng-options="item._id as item.title for item in entities | filter:entity.filters.inheritance('entity')">
                    <option value="">Select...</option>
                  </select>
              </div>

            </div>

              <!-- Entity Link -->
              <div ng-if="entity.selected.metaType == 'link'">
              <div class="form-group">
                <label for="">Type Of</label>
                <select class="form-control" ng-model="entity.selected.base" ng-options="item._id as item.title for item in entities | filter:entity.filters.inheritance('link')">
                    <option value="">Select...</option>
                  </select>
              </div>

              <div class="form-group">
                <label for="">Source Type</label>
                <select class="form-control" ng-model="entity.selected.source" ng-options="item._id as item.title for item in entities | filter:entity.filters.linkable">
                    <option value="">Select...</option>
                  </select>
              </div>


              <div class="form-group">
                <label for="">Target Type</label>
                <select class="form-control" ng-model="entity.selected.target" ng-options="item._id as item.title for item in entities | filter:entity.filters.linkable">
                    <option value="">Select...</option>
                  </select>
              </div>
            </div>

            </div>

            <div class="modal-footer">
              <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
              <button type="button" class="btn btn-primary" data-dismiss="modal" ng-click="entity.submit(entity.selected)">Submit</button>
            </div>
          </div>

        </div>
      </div>

      <!-- Edit Property Modal -->
      <div id="editPropertyModal" class="modal fade" role="dialog" ng-keydown="property.keyDown($event)">
        <div class="modal-dialog">
          <div class="modal-content">

            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal">&times;</button>
              <h4 class="modal-title">Edit Property</h4>
            </div>

            <div class="modal-body">
              <div class="form-group">
                <label ng-class="{invalid:!property.validation.title()}">Title</label>
                <input type="text" class="form-control" ng-model="property.selected.title" placeholder="Property title" />
              </div>

              <div class="form-group">
                <label for="">Type</label>
                <select class="form-control" ng-model="property.selected.type">
                  <option value="string">String</option>
                  <option value="number">Number</option>
                  <option value="boolean">Boolean</option>
                  <option value="common">Common Type</option>
                  <option value="link">Entity Link</option>
                </select>
              </div>

              <div class="form-group" ng-show="property.selected.type == 'common'">
                <label ng-class="{invalid:!property.validation.common()}">Common Type</label>
                <select class="form-control" ng-model="property.selected.targetType" ng-options="item._id as item.title for item in entities | filter:{metaType:'common'}">
                  <option value="">Select...</option>
                </select>
              </div>

              <div class="form-group" ng-show="property.selected.type == 'link'">
                <label ng-class="{invalid:!property.validation.link()}">Link Type</label>
                <select class="form-control" ng-model="property.selected.targetType" ng-options="item._id as item.title for item in entities | filter:{metaType:'link'}">
                  <option value="">Select...</option>
                </select>
              </div>

              <div class="form-group">
                <label>Is Mandatory</label>
                <input class="form-check-input" type="checkbox" ng-model="property.selected.required">
              </div>

              <div class="form-group">
                <label>Is Array</label>
                <input class="form-check-input" type="checkbox" ng-model="property.selected.multiple">
              </div>

            </div>

            <div class="modal-footer">
              <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
              <button type="button" class="btn btn-primary" data-dismiss="modal" ng-click="property.submit(entity.selected, property.selected)">Submit</button>

              <!--<div class="alert alert-danger fade in">
                <span>123</span>
              </div>-->
            </div>
          </div>

        </div>
      </div>

      <!-- Delete Entity Modal -->
      <div id="removeEntityModal" class="modal fade" role="dialog">
        <div class="modal-dialog">
          <div class="modal-content">

            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal">&times;</button>
              <h4 class="modal-title">Delete Entity</h4>
            </div>

            <div class="modal-body">
              <span>Are you sure you want to delete this entity ?</span>
            </div>

            <div class="modal-footer">
              <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
              <button type="button" class="btn btn-danger" data-dismiss="modal" ng-click="entity.remove(entity.pending, true)">Delete</button>
            </div>

          </div>
        </div>
      </div>

      <!-- Delete Property Modal -->
      <div id="removePropertyModal" class="modal fade" role="dialog">
        <div class="modal-dialog">
          <div class="modal-content">

            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal">&times;</button>
              <h4 class="modal-title">Delete Property</h4>
            </div>

            <div class="modal-body">
              <span>Are you sure you want to delete this property ?</span>
            </div>

            <div class="modal-footer">
              <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
              <button type="button" class="btn btn-danger" data-dismiss="modal" ng-click="property.remove(entity.selected, property.pending, true)">Delete</button>
            </div>

          </div>
        </div>
      </div>

    </div>

  </body>


  <!--<property-table entity="entity.selected"></property-table>-->

  <!--<table class="table table-striped" ng-show="entity.selected">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Type</th>
                    <th>Mandatory</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr ng-repeat="item in entity.properties | filter:property.filter | orderBy:'title'" ng-class="{derived: item.entityID != entity.selected._id}">
                    <td>
                      <span>{{item.title}}</span>
                      <span>({{item.entity.title}})</span>
                    </td>
                    <td>
                      <span ng-hide="item.type == 'common' || item.type == 'link'">{{item.type}}</span>
                      <span ng-show="item.type == 'common' || item.type == 'link'">{{entity.byID(item.targetType).title}}</span>
                      <span ng-show="item.multiple">[ ]</span>
                    </td>
                    <td>{{item.required}}</td>
                    <td>
                      <span class="glyphicon glyphicon-edit" title="Edit" ng-click="property.edit(entity.selected, item)"></span>
                      <span class="glyphicon glyphicon-remove" title="Edit" ng-click="property.remove(entity.selected, item)"></span>
                    </td>
                  </tr>
                </tbody>
              </table>-->